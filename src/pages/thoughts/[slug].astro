---
// src/pages/blog/[slug].astro
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Image } from "astro:assets";
import { getArticleSchema, thoughtsWebsite } from "../../utils/structuredData";

interface Props {
	post: CollectionEntry<"thoughts">;
}

export async function getStaticPaths() {
	const blogPosts = await getCollection("thoughts");
	return blogPosts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}
const { post } = Astro.props;

if (!post) {
	return { status: 404 };
}
const { Content } = await post.render();

const articleStructuredData = getArticleSchema(post);

const breadcrumbsStructuredData = {
	"@context": "https://schema.org",
	"@type": "BreadcrumbList",
	itemListElement: [
		{
			"@type": "ListItem",
			position: 1,
			name: "Thoughts",
			item: `${import.meta.env.SITE}/thoughts/`,
		},
		{
			"@type": "ListItem",
			position: 2,
			name: post.data.title,
			item: `${import.meta.env.SITE}/thoughts/${post.slug}/`,
		},
	],
};

const jsonLd = {
	"@context": "https://schema.org",
	"@graph": [articleStructuredData, breadcrumbsStructuredData, thoughtsWebsite],
};
---

<Layout title=`Thoughts â€¢ ${post.data.title}`>
	<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
	<div>
		<h1 class="text-[2rem] font-bold tracking-tight text-primary">
			{post.data.title}
		</h1>
		<p class="lead text-base font-medium tracking-tight text-title">
			{post.data.excerpt}
		</p>

		<Image
			src={post.data.cover}
			alt={post.data.title}
			class="mb-2 mt-6 h-auto w-full rounded-lg object-cover"
		/>

		<article
			class="prose prose-sm prose-headings:text-title prose-a:text-primary prose-a:underline-offset-4 prose-blockquote:text-title prose-strong:text-body prose-code:text-body prose-li:marker:text-body prose-img:rounded-md">
			<div class="font-normal text-body">
				<Content />
			</div>
		</article>
	</div>
</Layout>
